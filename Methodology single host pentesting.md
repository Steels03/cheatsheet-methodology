# Methodology single host pentesting

## Recon
### Port and service detection
1. `nmap -A X.X.X.X` (-Pn if hist doesn't respond to ping requests)
2. `nmap -sU X.X.X.X` (need to be root)
3. Search for CVE according to nmap resultats (cvedetails, github, etc.)

### Web
1. Search for domain name in headers and add it to etc/hosts if the webserver is running vhosts
2. `nikto -h http://X.X.X.X`
3. `dirb http://X.X.X.X`
4. `dirb http://X.X.X.X/directory/ -X '.php,.html'`
5. `nmap --script dns-brute example.com`
 
### Samba
1. Search for CVE according to nmap resultats (cvedetails, github, etc.)
2. `smclient -L \\X.X.X.X`
4. `smbclient \\\\X.X.X.X\\folder`
5. `smbmap -H X.X.X.X -u admin -p password`

### FTP
1. Search for CVE according to nmap resultats (cvedetails, github, etc.)
2. `ftp X.X.X.X`


## Exploitation
- Try different reverse shells if yours is failling
- Avoid metasploit
- Don't waiste to much time on one service, it might be a rabbit hole
- Prefere exploiting simple vulnerability than going for complex killchains
### Web
1. CVE exploitation
2. SQLi : `sqlmap -u http://X.X.X.X --dbs --batch` (add `--forms` if SQLi in post request)
3. LFI/RFI
4. XSS
5. CSRF
6. Cookies, tokens, etc.

https://cheatsheet.haax.fr/web-pentest/
https://github.com/swisskyrepo/PayloadsAllTheThings

### Samba
1. CVE exploitation
2. Connect as anonymous or guest user

### FTP
1. CVE exploitation
2. Connect as anonymous or guest user


## Privesc
### Windows
1. `systeminfo` and search for CVE
2. winpeas
3. whoami /priv

### Linux
1. Retrieve version and serach for CVE
2. linpeas
3. SUID scripts
4. root executions
5. `sudo -l`

## Post-exploitation
1. Search for password/token/key in files (.conf, .sh, .ps1, etc.)
2. Add ssh-key to connect later to the host